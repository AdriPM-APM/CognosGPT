<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CognosGPT - Asistente Inteligente</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      transition: background 0.3s ease;
    }
    .light-theme {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    .dark-theme {
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      color: #e5e7eb;
    }
    .chat-container {
      max-height: 70vh;
      overflow-y: auto;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: #9ca3af #f3f4f6;
    }
    .chat-container::-webkit-scrollbar {
      width: 8px;
    }
    .chat-container::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    .chat-container::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 4px;
    }
    .message {
      max-width: 80%;
      margin: 10px;
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.5;
      animation: fadeIn 0.3s ease;
    }
    .user-message {
      background-color: #3b82f6;
      color: white;
      margin-left: auto;
    }
    .ai-message {
      background-color: #e5e7eb;
      color: #1f2937;
      margin-right: auto;
    }
    .dark-theme .ai-message {
      background-color: #4b5563;
      color: #e5e7eb;
    }
    .loading::after {
      content: ' .';
      animation: dots 1.5s infinite;
    }
    .history-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 20;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .history-panel.show {
      opacity: 1;
      pointer-events: auto;
    }
    .history-content {
      background: white;
      dark:bg-gray-800;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease;
    }
    .dark-theme .history-content {
      background: #1f2937;
    }
    @keyframes dots {
      0% { content: ' .'; }
      33% { content: ' ..'; }
      66% { content: ' ...'; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body class="light-theme">
  <div class="container mx-auto p-4 max-w-4xl">
    <!-- Header -->
    <header class="flex justify-center items-center mb-8">
      <div class="text-center flex-1">
        <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-100">CognosGPT</h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2">Tu asistente para educación, programación y más</p>
      </div>
      <button
        id="theme-toggle"
        class="ml-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition"
        aria-label="Cambiar tema"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path id="theme-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
      </button>
    </header>

    <!-- Chat History Button -->
    <div class="flex justify-between mb-4">
      <button
        id="history-button"
        class="bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition"
        aria-label="Ver chats guardados"
      >
        Ver Chats Guardados
      </button>
      <button
        id="clear-button"
        class="bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition"
        aria-label="Limpiar chat"
      >
        Limpiar Chat
      </button>
    </div>

    <!-- Chat Container -->
    <div class="chat-container bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6" role="log" aria-live="polite">
      <div id="chat-box" class="flex flex-col gap-4">
        <!-- Messages will be appended here -->
      </div>
    </div>

    <!-- Input Form -->
    <div class="flex gap-2 items-end">
      <textarea
        id="user-input"
        placeholder="Escribe tu pregunta para CognosGPT..."
        class="flex-1 p-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none h-20"
        aria-label="Escribe tu mensaje"
      ></textarea>
      <button
        id="send-button"
        class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
        aria-label="Enviar mensaje"
      >
        Enviar
      </button>
    </div>

    <!-- History Panel -->
    <div class="history-panel" id="history-panel">
      <div class="history-content">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Chats Guardados</h2>
          <button id="close-history" class="text-gray-600 dark:text-gray-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <ul id="chat-list" class="space-y-2"></ul>
      </div>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const clearButton = document.getElementById('clear-button');
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const historyButton = document.getElementById('history-button');
    const historyPanel = document.getElementById('history-panel');
    const closeHistory = document.getElementById('close-history');
    const chatList = document.getElementById('chat-list');

    // Generar ID único para chats
    function generateId() {
      return 'id-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
    }

    // Cargar historial de chats desde localStorage
    function loadChatHistory() {
      const chats = JSON.parse(localStorage.getItem('chatHistory') || '{}');
      chatList.innerHTML = '';
      Object.keys(chats).forEach(chatId => {
        const chat = chats[chatId];
        const li = document.createElement('li');
        li.className = 'p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer text-gray-800 dark:text-gray-200';
        li.textContent = `${chat.title || 'Chat sin título'} (${chat.timestamp})`;
        li.dataset.chatId = chatId;
        li.addEventListener('click', () => {
          loadChat(chatId);
          historyPanel.classList.remove('show');
        });
        chatList.appendChild(li);
      });
    }

    // Cargar un chat específico
    function loadChat(chatId) {
      const chats = JSON.parse(localStorage.getItem('chatHistory') || '{}');
      const chat = chats[chatId];
      if (!chat) return;
      chatBox.innerHTML = '';
      chat.messages.forEach(({ content, isUser }) => addMessage(content, isUser));
      localStorage.setItem('currentChatId', chatId);
    }

    // Guardar mensaje en localStorage
    function saveMessage(content, isUser, chatId = null) {
      const chats = JSON.parse(localStorage.getItem('chatHistory') || '{}');
      const currentChatId = chatId || localStorage.getItem('currentChatId') || generateId();
      
      if (!chats[currentChatId]) {
        chats[currentChatId] = {
          title: content.length > 30 ? content.substring(0, 30) + '...' : content,
          timestamp: new Date().toLocaleString(),
          messages: []
        };
        localStorage.setItem('currentChatId', currentChatId);
      }
      
      chats[currentChatId].messages.push({ content, isUser });
      localStorage.setItem('chatHistory', JSON.stringify(chats));
      loadChatHistory();
    }

    // Agregar mensaje al chat
    function addMessage(content, isUser) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
      messageDiv.textContent = content;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Mostrar indicador de carga
    function showLoading() {
      const loadingDiv = document.createElement('div');
      loadingDiv.id = 'loading';
      loadingDiv.className = 'message ai-message loading';
      loadingDiv.textContent = 'CognosGPT está pensando';
      chatBox.appendChild(loadingDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
      return loadingDiv;
    }

    // Manejar el envío del mensaje
    sendButton.addEventListener('click', async () => {
      const prompt = userInput.value.trim();
      if (!prompt) return;

      // Agregar mensaje del usuario
      addMessage(prompt, true);
      saveMessage(prompt, true);
      userInput.value = '';

      // Mostrar indicador de carga
      const loadingDiv = showLoading();

      // Configurar el prompt de CognosGPT
      const cognosPrompt = `
        Tú eres CognosGPT, una IA avanzada diseñada para asistir en una amplia gama de temas con respuestas precisas, detalladas y adaptadas al contexto. Tus capacidades incluyen:
        - **Materias Educativas:** Actúa como un profesor experto, proporcionando explicaciones claras, ejemplos prácticos, analogías y pasos detallados para facilitar la comprensión.
        - **Programación:** Comportarte como un experto en programación, ofreciendo fragmentos de código funcionales, explicaciones de conceptos, mejores prácticas y soluciones para depuración en diversos lenguajes y frameworks.
        - **Consultas Generales:** Responde a otros temas con precisión, concisión y profundidad, basándote en una vasta base de conocimiento.

        Adapta tu tono y enfoque según la naturaleza de la consulta:
        - Para temas educativos, usa un estilo didáctico con ejemplos claros y estructurados.
        - Para programación, proporciona código comentado, explicaciones técnicas y consejos prácticos.
        - Para consultas generales, ofrece respuestas completas pero directas, priorizando la claridad.

        Si la consulta es ambigua o carece de contexto, haz preguntas clarificadoras o asume un contexto razonable para proporcionar una respuesta útil. Siempre busca maximizar la calidad y relevancia de tus respuestas.

        Consulta del usuario: "${prompt}"
      `;

      try {
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer <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>', // Inserta tu clave de API aquí
            'HTTP-Referer': '<https://cognos-gpt.vercel.app/>', // Inserta la URL de tu sitio aquí
            'X-Title': 'CognosGPT',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: 'deepseek/deepseek-chat-v3-0324:free',
            messages: [
              {
                role: 'user',
                content: cognosPrompt
              }
            ]
          })
        });

        if (!response.ok) throw new Error('Error en la respuesta de la API');

        const data = await response.json();
        const aiResponse = data.choices[0].message.content;
        chatBox.removeChild(loadingDiv);
        addMessage(aiResponse, false);
        saveMessage(aiResponse, false);
      } catch (error) {
        chatBox.removeChild(loadingDiv);
        addMessage(`Error: ${error.message || 'No se pudo conectar con la API. Verifica tu clave de API o conexión.'}`, false);
        saveMessage(`Error: ${error.message || 'No se pudo conectar con la API.'}`, false);
      }
    });

    // Mostrar/ocultar panel de historial
    historyButton.addEventListener('click', () => {
      historyPanel.classList.add('show');
    });

    // Cerrar panel al hacer clic fuera
    historyPanel.addEventListener('click', (e) => {
      if (e.target === historyPanel) {
        historyPanel.classList.remove('show');
      }
    });

    // Cerrar panel con botón
    closeHistory.addEventListener('click', () => {
      historyPanel.classList.remove('show');
    });

    // Limpiar chat
    clearButton.addEventListener('click', () => {
      chatBox.innerHTML = '';
      const currentChatId = localStorage.getItem('currentChatId');
      if (currentChatId) {
        const chats = JSON.parse(localStorage.getItem('chatHistory') || '{}');
        delete chats[currentChatId];
        localStorage.setItem('chatHistory', JSON.stringify(chats));
        localStorage.removeItem('currentChatId');
        loadChatHistory();
      }
    });

    // Cambiar tema
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      document.body.classList.toggle('dark-theme');
      const isDark = document.body.classList.contains('dark-theme');
      themeIcon.setAttribute('d', isDark
        ? 'M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z'
        : 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z');
    });

    // Enviar con Ctrl+Enter
    userInput.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'Enter') {
        sendButton.click();
      }
    });

    // Cargar historial al iniciar
    loadChatHistory();

    // Foco en el textarea al cargar la página
    userInput.focus();
  </script>
</body>
</html>
